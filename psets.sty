\usepackage{fancyhdr}
\usepackage{geometry}
\usepackage{tikz}

\geometry{top=120pt,bottom=60pt,left=70pt,right=70pt,headheight=20pt,headsep=4pt}

\usepackage{xcolor}
\definecolor{darkolivegreen}{RGB}{85,107,47}
\definecolor{chocolate}{RGB}{210,105,30}
\definecolor{midnightblue}{RGB}{25,25,112}
\definecolor{maroon}{RGB}{128,0,0}

\usepackage{tcolorbox}
\tcbuselibrary{raster,skins,breakable}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{txfonts}
\usepackage{bm}
\usepackage{datetime2}

% === 全体汎用 ===

%0埋め2桁数字に変換
\newcommand{\cnttwo}[1]{
    \ifnum \value{#1}<10
        0\arabic{#1}
    \else
        \arabic{#1}
    \fi
}

% 注釈
% text...\\
% \annot
% annotation...
\newcommand{\annot}{
    \hrule width 6cm
    \vspace{1mm}
}



% === ページ設定 ===
\pagestyle{fancy}

% カウンタ設定
\newcounter{secn}   % 章のカウンタ
\setcounter{secn}{-1}
\newcounter{pn}     % 章ごとのページカウンタ

\let\np\newpage
\renewcommand{\newpage}{
    \np
    \addtocounter{pn}{1}
}

% 通常ページの設定
\fancypagestyle{pg}{
    \newgeometry{top=100pt,bottom=60pt,left=70pt,right=70pt,headheight=20pt,headsep=4pt}
    \lhead{
        \begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
            \fill [black] (-9.65, -1.9) node[right] {{\Large \textbf{数学問題集}}};
            \fill [black] (9.15, -1.9) node[left] {{\Large \textbf{プリント}}{\large \cnttwo{secn}}{\normalsize -\cnttwo{pn}}};
            \fill [black] (-9.5,-2.8) rectangle (9, -2.2);
            \fill [white] (-9.2,-2.5) node[right] {{\normalsize \textbf{制作者 : }}{\large \textbf{Anman}}};
        \end{tikzpicture}
    }
    \lfoot{
        \begin{tikzpicture}[remember picture,overlay,shift={(current page.south)}]
            \fill [black] (-9.5, 1) rectangle (9, 1.6);
            \fill [white] (0, 1.3) node {\thepage};
        \end{tikzpicture}
    }
    \cfoot{}
    \renewcommand{\headrulewidth}{0pt}
}

% 章立てページのデザインを現在のページに反映
% \pgs{タイトル名前}
\newcommand{\pgs}[1]{
    \setcounter{pn}{0}
    \addtocounter{secn}{1}

    \setcounter{numpb}{0}

    \fancypagestyle{pgs}{
        \newgeometry{top=130pt,bottom=60pt,left=70pt,right=70pt,headheight=20pt,headsep=4pt}
        \lhead{
            \begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
                \fill [black] (-9.65, -1.9) node[right] {{\Large \textbf{数学問題集}}};
                \fill [black] (9.15, -1.9) node[left] {{\Large \textbf{プリント}}{\large \cnttwo{secn}}{\normalsize -\cnttwo{pn}}};
                \fill [black] (-9.5,-2.8) rectangle (9, -2.2);
                \fill [white] (-9.2,-2.5) node[right] {{\normalsize \textbf{制作者 : }}{\large \textbf{Anman}}};
                \fill [black] (0, -3.2) node {{\LARGE \textbf{#1}}};
                \fill [black] (-9.5,-4) rectangle (9, -3.5);
                \fill [white] (-9.2,-3.8) node[right] {{\small \textbf{更新日 : \number\day/\number\month/\number\year\ version \version}}};
            \end{tikzpicture}
        }
        \lfoot{
            \begin{tikzpicture}[remember picture,overlay,shift={(current page.south)}]
                \fill [black] (-9.5, 1) rectangle (9, 1.6);
                \fill [white] (0, 1.3) node {\thepage};
            \end{tikzpicture}
        }
        \cfoot{}
        \renewcommand{\headrulewidth}{0pt}
    }
    \thispagestyle{pgs}
}

% 章立てページのデザインを現在のページに反映（色も設定する）
% 以降の通常ページの色も変更
\newcommand{\pgsc}[2]{
    \setcounter{pn}{-1} % たぶん \pagestyleと\thispagestyle で ページが増えた扱いになるため?
    \addtocounter{secn}{1}

    \setcounter{numpb}{0}

    \fancypagestyle{pgs}{
        \newgeometry{top=130pt,bottom=60pt,left=70pt,right=70pt,headheight=20pt,headsep=4pt}
        \lhead{
            \begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
                \fill [#2] (-9.65, -1.9) node[right] {{\Large \textbf{数学問題集}}};
                \fill [#2] (9.15, -1.9) node[left] {{\Large \textbf{プリント}}{\large \cnttwo{secn}}{\normalsize -\cnttwo{pn}}};
                \fill [#2] (-9.5,-2.8) rectangle (9, -2.2);
                \fill [white] (-9.2,-2.5) node[right] {{\normalsize \textbf{制作者 : }}{\large \textbf{Anman}}};
                \fill [#2] (0, -3.2) node {{\LARGE \textbf{#1}}};
                \fill [#2] (-9.5,-4) rectangle (9, -3.5);
                \fill [white] (-9.2,-3.8) node[right] {{\small \textbf{更新日 : \number\day/\number\month/\number\year\ version \version}}};
            \end{tikzpicture}
        }
        \lfoot{
            \begin{tikzpicture}[remember picture,overlay,shift={(current page.south)}]
                \fill [#2] (-9.5, 1) rectangle (9, 1.6);
                \fill [white] (0, 1.3) node {\thepage};
            \end{tikzpicture}
        }
        \cfoot{}
        \renewcommand{\headrulewidth}{0pt}
    }


    \fancypagestyle{pg}{
        \newgeometry{top=100pt,bottom=60pt,left=70pt,right=70pt,headheight=20pt,headsep=4pt}
        \lhead{
            \begin{tikzpicture}[remember picture,overlay,shift={(current page.north)}]
                \fill [#2] (-9.65, -1.9) node[right] {{\Large \textbf{数学問題集}}};
                \fill [#2] (9.15, -1.9) node[left] {{\Large \textbf{プリント}}{\large \cnttwo{secn}}{\normalsize -\cnttwo{pn}}};
                \fill [#2] (-9.5,-2.8) rectangle (9, -2.2);
                \fill [white] (-9.2,-2.5) node[right] {{\normalsize \textbf{制作者 : }}{\large \textbf{Anman}}};
            \end{tikzpicture}
        }
        \lfoot{
            \begin{tikzpicture}[remember picture,overlay,shift={(current page.south)}]
                \fill [#2] (-9.5, 1) rectangle (9, 1.6);
                \fill [white] (0, 1.3) node {\thepage};
            \end{tikzpicture}
        }
        \cfoot{}
        \renewcommand{\headrulewidth}{0pt}
    }
    \pagestyle{pg}
    \thispagestyle{pgs}
}


\newenvironment{nmprob}{\newpage}{}
\newenvironment{fsprob}{}{}
